<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title th:text="'PLUG::'+${post.getTitle()}">Title</title>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"
            integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paginationjs/2.1.4/pagination.min.js"></script>

    <script>

        /*<![CDATA[*/
        function commentUpdateBtn(id) {
            let feedId = [[${post.id}]];
            let content = $('#comment-modify-input').val();
            console.log(feedId, content)
            $.ajax({
                type: "PUT",
                url: `/api/post/` + id,
                contentType: "application/json",
                data: JSON.stringify({postId: id, body: content}),
            }).done(function () {
                alert("댓글 수정 성공");
            }).fail(function (res) {
                alert(res.responseText);
            })
        }
        /*]]>*/

        /*<![CDATA[*/
        function commentDeleteBtn(id) {
            let feedId = [[${post.id}]];
            let content = $('#comment-modify-input').val();
            console.log(feedId, content)
            $.ajax({
                type: "DELETE",
                url: `/api/post/` + id,
                contentType: "application/json",
                data: JSON.stringify({postId: id, body: content}),
            }).done(function () {
                alert("댓글 삭제 성공");
            }).fail(function (res) {
                alert(res.responseText);
            })
        }
        /*]]>*/

    </script>
</head>
<body>
<div>
    <p th:text="${post.getTitle()}"></p>
    <p th:text="${post.getInfo()}"></p>
    <p th:text="${post.getAuthor()}"></p>
    <p th:text="${post.getModifiedAt()}"></p>
</div>

<div>
    <ul th:if="${list.size() == 0}">
        <li>등록된 댓글이 없습니다.</li>
    </ul>
    <ul th:unless="${list.size() == 0}">
        <li th:each="comment : ${list}"> <!--수정, 삭제 버튼 생성-->
            <span th:text="${comment.getBody()}"></span>
            <span th:text="${comment.getUsername()}"></span>

            <button type="button" class="commentUpdateBtn" th:comment="${comment.getId()}" th:onclick="commentUpdateBtn(this.getAttribute('comment'))">수정</button>
            <input id="comment-modify-input" placeholder="수정하실 댓글내용을 입력해 주세요.">

            <button type="button" class="commentDeleteBtn" th:onclick="commentDeleteBtn(${comment.getId()})">삭제</button>


        </li>
    </ul>
</div>

<div id="comment-form">
    <form th:action="@{/api/comment}" method="post"> <!--삭제, 수정 코멘트의 api 아이디-->
        <input type="hidden" name="postId" th:value="${post.getId()}">
        <input type="text" name="body" placeholder="댓글을 입력하세요" required>
        <button type="submit" id="comment-id-submit">댓글 등록</button>
    </form>
</div>
</body>

<script>
    $(document).ready(function () {
        const auth = getToken();
        if (auth !== undefined && auth !== '') {
            $.ajaxPrefilter(function (options, originalOptions, jqXHR) {
                jqXHR.setRequestHeader('Authorization', auth);
            });
        }
    })

    function getToken() {
        let auth = Cookies.get('Authorization');
        if (auth === undefined) {
            return '';
        }

        return auth;
    }

    document.getElementById("comment-id-submit").addEventListener("click", function() {
        var form = document.getElementById("comment-form");
        var formData = new FormData(form);
        var jsonObject = {};

        for (var pair of formData.entries()) {
            jsonObject[pair[0]] = pair[1];
        }

        var jsonData = JSON.stringify(jsonObject);
        console.log(jsonData);  // 입력값을 JSON 형식으로 출력

        // JSON 데이터를 서버로 전송하거나 필요한 작업을 수행할 수 있습니다.
        // 예를 들어, fetch API를 사용하여 서버로 전송하는 등의 작업을 수행할 수 있습니다.

    });

</script>
</html>